<div class="section section-basic">
  <br />
  <br />
  <div class="container">
    <div id="inputs">
      <h4 *ngIf="!service.id">Novo serviço</h4>
      <h4 *ngIf="service.id">Alterar serviço</h4>
      <br />
      <div *ngFor="let alert of alerts">
        <ngb-alert [type]="alert.type" [dismissible]="false">
          <div class="container">
            <div class="alert-wrapper">
              <button type="button" name="button" class="close" (click)="closeAlert(alert)">
                <span aria-hidden="true">
                  <i class="now-ui-icons ui-1_simple-remove"></i>
                </span>
              </button>
              <div class="message">
                <ng-container *ngIf="alert.icon">
                  <div class="alert-icon">
                    <i class="now-ui-icons {{alert.icon}}"></i>
                  </div>
                </ng-container>
                <strong>{{alert.strong}} </strong>{{ alert.message }}
              </div>
            </div>
          </div>
        </ngb-alert>
      </div>
    </div>

    <div class="autosafe-card">
      <div class="row">
        <div class="col-sm-12 col-lg-12">
          <div class="row mb-3" *ngIf="companyTypes.length > 0">
  <div class="col-12 d-flex justify-content-between align-items-center">
    <div>
      <p class="category">Selecione o Tipo do serviço *</p>
      <div class="d-flex flex-wrap gap-2">
        <button *ngFor="let type of companyTypes" class="btn btn-primary btn-round" type="button"
          [ngbTooltip]="type.description"
          [ngClass]="{'active': isCompanyTypeSelected(type.id), 'btn-simple': !isCompanyTypeSelected(type.id)}"
          (click)="toggleCompanyType(type.id)">
          <ng-container *ngIf="isCompanyTypeSelected(type.id)">
            <i class="now-ui-icons ui-1_check"></i>
          </ng-container>
          {{ type.name }}
        </button>
      </div>
    </div>

    <!-- Switch do Permitir Agendamento -->
    <div class="form-group mb-0 text-right">
      <label class="d-block">Permitir Agendamento</label>
      <bSwitch [(ngModel)]="service.enableScheduling"
               switch-on-text="Sim"
               switch-off-text="Não">
      </bSwitch>
    </div>
  </div>
</div>


    <div class="autosafe-card">

      <div class="row">
        <div class="col-sm-6 col-lg-6">
          <div class="form-group">
            <label>Título *</label>
            <input type="text" [(ngModel)]="service.title" placeholder="Titulo" maxlength="35" class="form-control" />
          </div>
        </div>

        <div class="col-sm-6 col-lg-3">
          <div class="form-group">
            <label>Valor *</label>
            <input type="text" [(ngModel)]="service.price" mask="separator.2" thousandSeparator="." decimalMarker=","
              prefix="R$ " [dropSpecialCharacters]="true" [allowNegativeNumbers]="false" [validation]="true"
              placeholder="Preco" class="form-control" />
          </div>
        </div>
        <div class="col-sm-6 col-lg-3">
          <div class="form-group">
            <label>Tipo preço</label>
            <div class="dropdown button-dropdown-new">
              <div ngbDropdown>
                <a *ngIf="priceTypeSelected" class="btn btn-primary btn-round" type="button" ngbDropdownToggle>
                  {{priceTypeSelected.label}}
                </a>
                <a *ngIf="!priceTypeSelected" class="btn btn-primary btn-round" type="button" ngbDropdownToggle>
                  Selecione
                </a>
                <div ngbDropdownMenu>
                  <a class="dropdown-header">Tipos de precos</a>
                  <a *ngFor="let type of priceTypes" class="dropdown-item" (click)="selectPriceType(type)">
                    {{type.label}}
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-sm-6 col-lg-10">
          <div class="form-group">
            <label>Descrição *</label>
            <input type="text" [(ngModel)]="service.description" maxlength="120" placeholder="Descricao"
              class="form-control" />
          </div>
        </div>





        <div class="col-sm-6 col-lg-2">
          <div class="form-group">
            <p>Ativo</p>
            <bSwitch [(ngModel)]="service.isActive" switch-on-text="Sim" switch-off-text="Nao"></bSwitch>
          </div>
        </div>
      </div>
    </div>


    <div class="autosafe-card">
      <div class="row">
        <div class="col-sm-12 col-lg-6">
          <div class="form-group">
            <label>Imagem *</label>
            <div class="image-upload-container-new">
              <input type="file" class="form-control service-file-input-new" accept="image/png,image/jpeg"
                (change)="onImageChange($event)" />

              <div class="image-upload-info">
                <small class="upload-text">PNG ou JPG até 5MB</small>
                <small class="upload-text">
                  Tamanho recomendado: <strong>1:1</strong> — <strong>945 × 945 px</strong>
                </small>

                <small class="file-info" *ngIf="selectedFileName">
                  Arquivo selecionado: {{ selectedFileName }}
                </small>
                <small class="file-info" *ngIf="!selectedFileName && service?.imageUrl">
                  Arquivo atual: {{ getFileNameFromUrl(service.imageUrl) }}
                </small>
              </div>
            </div>
          </div>
        </div>

        <div class="col-sm-12 col-lg-6">
          <div class="form-group">
            <label>Pré-visualização</label>
            <div class="image-preview-container" [class.empty]="!previewUrl && !service?.imageUrl">
              <div class="container-1-1">

                <img *ngIf="previewUrl; else existingImage" [src]="previewUrl" alt="Prévia do serviço"
                class="preview-image" />
              </div>
              <ng-template #existingImage>
                <div class="container-1-1">

                  <img *ngIf="service?.imageUrl" [src]="service.imageUrl" alt="Imagem atual do serviço"
                  class="preview-image" />
                </div>
                <div class="image-placeholder" *ngIf="!service?.imageUrl">
                  <i class="now-ui-icons media-1_camera-compact"></i>
                  <span> Sem imagem</span>
                </div>
              </ng-template>

              <!-- Preview Overlay -->
              <div class="preview-overlay" *ngIf="previewUrl || service?.imageUrl">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="autosafe-card">

      <!-- Personalizar -->
      <br />
      <div class="row">
        <div class="col-sm-12 col-lg-12">
          <div class="form-group">
            <p class="category">Personalizar por veículo</p>
          </div>
        </div>

        <div class="col-sm-12 col-lg-12">
          <div class="form-group">
            <label>Configurações por veiculos</label>
            <div class="form-check">
              <label class="form-check-label">
                <input class="form-check-input" type="checkbox" [(ngModel)]="service.appliesToAllVehicles">
                <span class="form-check-sign"></span>
                {{ service.appliesToAllVehicles ? 'Aplica-se a todos os veiculos' : 'Aplica-se apenas ao veiculo selecionado' }}
              </label>
            </div>
          </div>
        </div>

        <div class="col-sm-6 col-lg-3" *ngIf="!service.appliesToAllVehicles">
          <div class="form-group">
            <label>Marcas</label>
            <div class="dropdown button-dropdown-new">
              <div ngbDropdown>
                <a *ngIf="brandSelected !== null" class="btn btn-primary btn-round" type="button" ngbDropdownToggle>
                  {{brandSelected.name}}
                </a>
                <a *ngIf="brandSelected === null" class="btn btn-primary btn-round" type="button" ngbDropdownToggle>
                  Selecione a Marca
                </a>
                <div ngbDropdownMenu>
                  <a class="dropdown-header">Marcas</a>
                  <input type="text" placeholder="Pesquisar marca" class="form-control mb-2"
                    [(ngModel)]="searchBrandTerm" (input)="onBrandSearchChange()" />
                  <a *ngFor="let brand of filteredBrandList" class="dropdown-item" (click)="setBrandSelected(brand)">
                    {{brand.name}}
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-sm-6 col-lg-3" *ngIf="!service.appliesToAllVehicles">
          <div class="form-group">
            <label>Modelos</label>
            <div class="dropdown button-dropdown-new">
              <div ngbDropdown>
                <a *ngIf="modelSelected !== null" class="btn btn-primary btn-round" type="button" ngbDropdownToggle>
                  {{modelSelected.name}}
                </a>
                <a *ngIf="modelSelected === null" class="btn btn-primary btn-round" type="button" ngbDropdownToggle>
                  Selecione o Modelo
                </a>
                <div ngbDropdownMenu>
                  <a class="dropdown-header">Modelos</a>
                  <input type="text" placeholder="Pesquisar modelo" class="form-control mb-2"
                    [(ngModel)]="searchModelTerm" (input)="onModelSearchChange()" />
                  <a *ngFor="let model of filteredModelList" class="dropdown-item" (click)="setModelSelected(model)">
                    {{model.name}}
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-sm-6 col-lg-4" *ngIf="!service.appliesToAllVehicles">
          <div class="form-group">
            <p></p>
            <a class="btn btn-primary btn-simple btn-round" type="button" (click)="addBrandModelToList()">
              <i class="now-ui-icons ui-1_simple-add"></i> Adicionar
            </a>
          </div>
        </div>

        <br />

        <div *ngIf="!service.appliesToAllVehicles && listBrandModelSelected.length > 0"
          class="info-alert col-sm-6 col-lg-12">
          <p class="info-text">
            Seus serviços aparecerão apenas para donos de:
          </p>
        </div>
       <div class="row" *ngIf="!service.appliesToAllVehicles && listBrandModelSelected.length > 0">
  <div class="vehicles-list col-lg-12">
    <div class="vehicle-item" *ngFor="let brandModel of listBrandModelSelected; let i = index">
      <div class="vehicle-info">
        <div class="vehicle-icon-container">
          <svg class="vehicle-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path
              d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9L18.4 10c-.2-.5-.8-.9-1.4-.9H7c-.6 0-1.2.4-1.4.9L3.5 11.1C2.7 11.3 2 12.1 2 13v3c0 .6.4 1 1 1h2" />
            <circle cx="7" cy="17" r="2" />
            <path d="M9 17h6" />
            <circle cx="17" cy="17" r="2" />
          </svg>
        </div>

        <div class="vehicle-details">
          <div class="vehicle-brand">{{ brandModel.brand.name }}</div>
          <div class="vehicle-model" *ngIf="brandModel.model">{{ brandModel.model.name }}</div>
        </div>
      </div>

      <button class="remove-button" (click)="removeBrandModelSelected(i)">
        <svg class="x-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6 6 18" />
          <path d="M6 6l12 12" />
        </svg>
      </button>
    </div>
  </div>
</div>


        <br />
        <br />

      </div>

    </div>
    <div class="autosafe-card">
      <div class="row">
        <div class="ml-auto mr-auto">
          <button class="btn btn-success btn-round btn-lg" type="button" (click)="saveService()">
            <i class="now-ui-icons ui-1_check"></i> Salvar Serviço
          </button>
        </div>
      </div>
    </div>
  </div>